package com.github.machosmurf.exploitdbwatchdog;

import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.CrudRepository;

import java.util.List;

public interface ExploitRepository extends CrudRepository<Exploit, Integer> {

    Exploit findByExploitID(int exploitID);

    List<Exploit> findExploitsByType(String type);

    List<Exploit> findByPlatform(String platform);

    List<Exploit> findByPort(int port);

    List<Exploit> findByLanguageAndDescriptionContaining(String language, String tag);

    List<Exploit> findByLanguage(String language);

    List<Exploit> findByGeneralTypeAndAuthor(GeneralType generalType, String author);

    List<Exploit> findByGeneralTypeAndDescriptionContaining(GeneralType generalType, String tag);

    List<Exploit> findByPlatformAndDescriptionContaining(String platform, String tag);

    @Query(value = "SELECT NEW com.github.machosmurf.exploitdbwatchdog.Type(e.type, COUNT(e.type)) FROM Exploit e " +
            "GROUP BY e.type HAVING e.type != ''")
    List<Type> findTypeCount();

    @Query(value = "SELECT NEW com.github.machosmurf.exploitdbwatchdog.Language(e.language, COUNT(e.language)) FROM Exploit e GROUP BY e.language")
    List<Language> findLanguageCount();

    @Query(value = "SELECT NEW com.github.machosmurf.exploitdbwatchdog.Port(e.port, COUNT(e.port)) FROM Exploit e GROUP BY e.port HAVING e.port > 0")
    List<Port> findPortCount();

    @Query(value = "SELECT NEW com.github.machosmurf.exploitdbwatchdog.Platform(e.platform, COUNT(e.platform)) FROM Exploit e GROUP BY e.platform")
    List<Platform> findPlatformCount();
}
