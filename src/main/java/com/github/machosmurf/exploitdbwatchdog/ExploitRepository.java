package com.github.machosmurf.exploitdbwatchdog;

import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.CrudRepository;

import java.util.List;

public interface ExploitRepository extends CrudRepository<Exploit, Integer> {

    Exploit findByExploitID(int exploitID);

    List<Exploit> findExploitsByType(String type);

    List<Exploit> findByPlatform(String platform);

    List<Exploit> findByPort(int port);

    List<Exploit> findByLanguageAndDescriptionContaining(String language, String tag);

    List<Exploit> findByLanguage(String language);

    List<Exploit> findByGeneralTypeAndAuthor(GeneralType generalType, String author);

    List<Exploit> findByGeneralTypeAndDescriptionContaining(GeneralType generalType, String tag);

    List<Exploit> findByPlatformAndDescriptionContaining(String platform, String tag);

    @Query(value = "SELECT DISTINCT(e.type) as type, COUNT(e.type) as count FROM Exploit e GROUP BY e.type")
    List<DatabaseStats.Type> findTypeCount();

    @Query(value = "SELECT DISTINCT(e.language) as language, COUNT(e.language) as count FROM Exploit e GROUP BY e.language")
    List<Object> findLanguageCount();

    @Query(value = "SELECT DISTINCT(e.port) as port, COUNT(e.port) as count FROM Exploit e GROUP BY e.port")
    List<DatabaseStats.Port> findPortCount();

    @Query(value = "SELECT DISTINCT(e.platform) as platform, COUNT(e.platform) as count FROM Exploit e GROUP BY e.platform")
    List<DatabaseStats.Platform> findPlatformCount();
}
